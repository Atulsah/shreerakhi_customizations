[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer Visit",
  "enabled": 1,
  "modified": "2025-10-18 13:50:57.178937",
  "module": "Shree",
  "name": "Custom Customer Visit",
  "script": "frappe.ui.form.on('Customer Visit', {\r\n\r\n    // ----------------------\r\n    // Form Load\r\n    // ----------------------\r\n    onload: function(frm) {\r\n        // Fetch states from Address DocType (client-side)\r\n        frappe.db.get_doc('DocType', 'Address').then(address_doctype => {\r\n            let state_field = address_doctype.fields.find(f => f.fieldname === 'state');\r\n            if (state_field && state_field.options) {\r\n                let states = state_field.options.split('\\n');\r\n                frm.set_df_property('state', 'options', states.join('\\n'));\r\n            }\r\n        });\r\n    },\r\n\r\n    // ----------------------\r\n    // Form Refresh\r\n    // ----------------------\r\n    refresh: function(frm) {\r\n        toggle_buttons(frm);\r\n        calculate_days_before(frm);\r\n    },\r\n\r\n    // ----------------------\r\n    // Field Change Events\r\n    // ----------------------\r\n    visit_date: function(frm) {\r\n        calculate_days_before(frm);\r\n    },\r\n\r\n    d_day: function(frm) {\r\n        calculate_days_before(frm);\r\n    },\r\n\r\n    customer_type: function(frm) {\r\n        toggle_buttons(frm);\r\n    },\r\n\r\n    customer: async function(frm) {\r\n        if (!frm.doc.customer) {\r\n            frm.set_value('customer_details', '');\r\n            frm.fields_dict.address_html.$wrapper.html('');\r\n            return;\r\n        }\r\n\r\n        // Fetch customer doc including primary address\r\n        let customer_doc = await frappe.db.get_doc('Customer', frm.doc.customer);\r\n\r\n        let address_html = '';\r\n        let details_html = '';\r\n\r\n        if (customer_doc.customer_primary_address) {\r\n            // Fetch the primary address doc\r\n            let addr = await frappe.db.get_doc('Address', customer_doc.customer_primary_address);\r\n\r\n            let full_address = `\r\n                ${addr.address_line1 || ''}<br>\r\n                ${addr.address_line2 || ''}<br>\r\n                ${addr.city || ''}, ${addr.state || ''} - ${addr.pincode || ''}<br>\r\n            `;\r\n\r\n            address_html = `\r\n                <div style=\"line-height:1.5; font-size:13px;\">\r\n                    <b>Address:</b><br>${full_address}\r\n                    <b>Contact:</b> ${addr.phone || ''}<br>\r\n                    <b>GSTIN:</b> ${addr.gstin || ''}<br>\r\n                </div>\r\n            `;\r\n\r\n            details_html = `\r\n                <b>Name:</b> ${customer_doc.customer_name}<br>\r\n                <b>Address:</b> ${addr.address_line1 || ''}, ${addr.city || ''}<br>\r\n                <b>Contact:</b> ${addr.phone || ''}<br>\r\n                <b>GSTIN:</b> ${addr.gstin || ''}<br>\r\n            `;\r\n        } else {\r\n            details_html = `<b>Name:</b> ${customer_doc.customer_name}<br><span style=\"color:gray;\">No primary address found</span>`;\r\n            address_html = `<span style=\"color:gray;\">No primary address linked</span>`;\r\n        }\r\n\r\n        frm.set_value('customer_details', details_html);\r\n        frm.refresh_field('customer_details');\r\n        frm.fields_dict.address_html.$wrapper.html(address_html);\r\n    },\r\n\r\n    edit_customer_button: function(frm) {\r\n        if (frm.doc.customer) {\r\n            frappe.set_route('Form', 'Customer', frm.doc.customer);\r\n        } else {\r\n            frappe.msgprint('Please select a customer first');\r\n        }\r\n    },\r\n\r\n    create_new_customer_button: function(frm) {\r\n        frappe.new_doc('Customer');\r\n    }\r\n\r\n});\r\n\r\n// ----------------------\r\n// Helper Functions\r\n// ----------------------\r\nfunction calculate_days_before(frm) {\r\n    if(frm.doc.visit_date && frm.doc.d_day) {\r\n        frm.set_value('days_before_d_day', frappe.datetime.get_diff(frm.doc.d_day, frm.doc.visit_date));\r\n    } else {\r\n        frm.set_value('days_before_d_day', null);\r\n    }\r\n}\r\n\r\nfunction toggle_buttons(frm) {\r\n    if (frm.doc.customer_type === 'Old Customer') {\r\n        frm.set_df_property('customer', 'reqd', 1);\r\n        frm.set_df_property('edit_customer_button', 'hidden', 0);\r\n        frm.set_df_property('create_new_customer_button', 'hidden', 1);\r\n    } else if (frm.doc.customer_type === 'New Customer') {\r\n        frm.set_df_property('customer', 'reqd', 0);\r\n        frm.set_df_property('edit_customer_button', 'hidden', 1);\r\n        frm.set_df_property('create_new_customer_button', 'hidden', 0);\r\n        frm.set_value('customer', '');\r\n        frm.set_value('customer_details', '');\r\n        frm.fields_dict.address_html.$wrapper.html('');\r\n    }\r\n}\r\n\r\n\r\n// ----------------------\r\n// Filter Customer by State/City (Working Version)\r\n// ----------------------\r\nfunction set_customer_query(frm) {\r\n    frm.set_query('customer', async function() {\r\n        let filters = [];\r\n        if (frm.doc.state) filters.push(['state', '=', frm.doc.state]);\r\n        if (frm.doc.city) filters.push(['city', '=', frm.doc.city]);\r\n\r\n        if (filters.length === 0) return {}; // no filter if both empty\r\n\r\n        // Fetch addresses first\r\n        let addresses = await frappe.db.get_list('Address', {\r\n            fields: ['name'],\r\n            filters: filters\r\n        });\r\n\r\n        let address_names = addresses.map(a => a.name);\r\n\r\n        return {\r\n            filters: {\r\n                customer_primary_address: ['in', address_names]\r\n            }\r\n        };\r\n    });\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Stock Entry",
  "enabled": 1,
  "modified": "2025-09-02 18:33:02.787957",
  "module": "Shree",
  "name": "Custom Stock Entry",
  "script": "frappe.ui.form.on('Stock Entry', {\r\n    refresh: function(frm) {\r\n        frm.doc.items.forEach(row => {\r\n            let workstation = frm.doc.custom_factory__location || \"\";\r\n            let bill_no = frm.doc.custom_bill_no || \"\";\r\n            let combined_value = workstation && bill_no\r\n                ? (workstation + \"-\" + bill_no)\r\n                : (workstation || bill_no);\r\n\r\n            frappe.model.set_value(row.doctype, row.name, 'custom_factory_bill_no', combined_value);\r\n        });\r\n    }\r\n});\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-10-25 15:31:27.742282",
  "module": "Shree",
  "name": "Custom Sales Invoice",
  "script": "frappe.ui.form.on(\"Sales Invoice\", {\r\n    refresh: function(frm) {\r\n        frm.fields_dict['custom_bos_transporter'].get_query = function(doc) {\r\n            return {\r\n                filters: {\r\n                    is_transporter: 1\r\n                }\r\n            };\r\n        };\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Sales Invoice Item', {\r\n    item_code: function(frm, cdt, cdn) {\r\n        check_duplicate_item(frm, cdt, cdn);\r\n    },\r\n    items_add: function(frm, cdt, cdn) {\r\n        check_duplicate_item(frm, cdt, cdn);\r\n    }\r\n});\r\n\r\n// ---------- Helper Function ----------\r\nfunction check_duplicate_item(frm, cdt, cdn) {\r\n    let row = locals[cdt][cdn];\r\n    if (!row.item_code) return;\r\n\r\n    // Find all items with the same item_code\r\n    let duplicates = [];\r\n    frm.doc.items.forEach((item, index) => {\r\n        if (item.item_code === row.item_code && item.name) {\r\n            duplicates.push({\r\n                item_code: item.item_code,\r\n                row: index + 1,\r\n                name: item.name\r\n            });\r\n        }\r\n    });\r\n\r\n    // Check if there are duplicates (more than 1 occurrence)\r\n    if (duplicates.length > 1) {\r\n        // Find the first occurrence row number\r\n        let first_row = duplicates[0].row;\r\n        \r\n        frappe.msgprint({\r\n            title: __(\"Duplicate Item Found\"),\r\n            message: __(\"Item <b>{0}</b> has already been added earlier at Row {1}.\", [row.item_code, first_row]),\r\n            indicator: \"red\"\r\n        });\r\n\r\n        // Remove the duplicate row\r\n        frappe.model.clear_doc(cdt, cdn);\r\n        frm.refresh_field('items');\r\n    }\r\n}\r\n\r\n// ===== No of Carton - Add/Update ===== //\r\n\r\nfrappe.ui.form.on('Sales Invoice', {\r\n    refresh: function(frm) {\r\n        update_carton_count(frm);\r\n    },\r\n    \r\n    items_add: function(frm, cdt, cdn) {\r\n        update_carton_count(frm);\r\n    },\r\n    \r\n    items_remove: function(frm, cdt, cdn) {\r\n        update_carton_count(frm);\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on('Sales Invoice Item', {\r\n    qty: function(frm, cdt, cdn) {\r\n        update_carton_count(frm);\r\n    },\r\n    \r\n    item_code: function(frm, cdt, cdn) {\r\n        update_carton_count(frm);\r\n    }\r\n});\r\n\r\nfunction update_carton_count(frm) {\r\n    let carton_qty = 0;\r\n    \r\n    // Loop through all items in the invoice\r\n    if (frm.doc.items) {\r\n        frm.doc.items.forEach(function(item) {\r\n            // Check if the item name contains \"Packing & Forwarding Charges\"\r\n            // This will match items like \"Packing & Forwarding Charges - Export\", etc.\r\n            if ((item.item_name && item.item_name.includes(\"Packing & Forwarding Charges\")) || \r\n                (item.item_code && item.item_code.includes(\"Packing & Forwarding Charges\"))) {\r\n                carton_qty = item.qty || 0;\r\n            }\r\n        });\r\n    }\r\n    \r\n    // Set the value to custom field\r\n    frm.set_value('custom_number_of_carton', carton_qty);\r\n}\r\n\r\n//======= WHATSAPP MESSAGE SECTION =========//\r\n\r\nfrappe.ui.form.on(\"Sales Invoice\", {\r\n    refresh(frm) {\r\n        // Only show button for submitted invoices with a key\r\n        if (frm.doc.docstatus === 1 && frm.doc.custom_public_access_key) {\r\n            frm.add_custom_button(__(\"Send via WhatsApp\"), async function() {\r\n                try {\r\n                    // ‚úÖ Fetch Customer Phone Number\r\n                    let mobile = \"\";\r\n                    \r\n                    // Try to get phone from customer address\r\n                    if (frm.doc.customer_address) {\r\n                        const address_resp = await frappe.call({\r\n                            method: \"frappe.client.get\",\r\n                            args: {\r\n                                doctype: \"Address\",\r\n                                name: frm.doc.customer_address\r\n                            }\r\n                        });\r\n\r\n                        if (address_resp && address_resp.message) {\r\n                            let addr = address_resp.message;\r\n                            mobile = addr.phone || addr.mobile_no || \"\";\r\n                        }\r\n                    }\r\n\r\n                    // If not found in address, try customer mobile\r\n                    if (!mobile && frm.doc.contact_mobile) {\r\n                        mobile = frm.doc.contact_mobile;\r\n                    }\r\n\r\n                    if (!mobile) {\r\n                        frappe.msgprint({\r\n                            title: __(\"Phone Number Missing\"),\r\n                            message: __(\"Customer phone number not found. Please add it in Customer Address.\"),\r\n                            indicator: \"red\"\r\n                        });\r\n                        return;\r\n                    }\r\n\r\n                    // ‚úÖ Clean and add country code\r\n                    mobile = mobile.replace(/\\D/g, \"\"); // Remove non-digits\r\n                    if (!mobile.startsWith(\"91\")) {\r\n                        mobile = \"91\" + mobile;\r\n                    }\r\n\r\n                    // ‚úÖ Build secure link\r\n                    const secure_link = `${window.location.origin}/api/method/shreerakhi_customizations.api.public.get_invoice?key=${frm.doc.custom_public_access_key}`;\r\n\r\n                    // ‚úÖ Compose WhatsApp message\r\n                    const amount = frm.doc.rounded_total || frm.doc.grand_total;\r\n                    const msg = `‡§®‡§Æ‡§∏‡•ç‡§§‡•á ${frm.doc.customer_name},\r\n\r\n‡§Ü‡§™‡§ï‡§æ Invoice *${frm.doc.name}* ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§π‡•à‡•§\r\nüí∞ ‡§∞‡§æ‡§∂‡§ø: ‚Çπ${amount}\r\n\r\nüìé Invoice ‡§¶‡•á‡§ñ‡•á‡§Ç/Download ‡§ï‡§∞‡•á‡§Ç:\r\n${secure_link}\r\n\r\nüôè ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶!`;\r\n\r\n                    // ‚úÖ Show dialog with options\r\n                    const d = new frappe.ui.Dialog({\r\n                        title: __('Send Invoice via WhatsApp'),\r\n                        fields: [\r\n                            {\r\n                                fieldtype: 'HTML',\r\n                                options: `\r\n                                    <div style=\"margin-bottom: 15px;\">\r\n                                        <strong>Customer:</strong> ${frm.doc.customer_name}<br>\r\n                                        <strong>Mobile:</strong> +${mobile}<br>\r\n                                        <strong>Invoice:</strong> ${frm.doc.name}<br>\r\n                                        <strong>Amount:</strong> ‚Çπ${amount}\r\n                                    </div>\r\n                                    <div style=\"background: #f5f5f5; padding: 10px; border-radius: 5px; margin-bottom: 15px;\">\r\n                                        <pre style=\"white-space: pre-wrap; font-family: inherit; margin: 0;\">${msg}</pre>\r\n                                    </div>\r\n                                `\r\n                            }\r\n                        ],\r\n                        primary_action_label: __('Open WhatsApp'),\r\n                        primary_action: function() {\r\n                            // Detect if mobile device\r\n                            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);\r\n                            \r\n                            // Use different URL based on device\r\n                            let whatsapp_url;\r\n                            if (isMobile) {\r\n                                // Mobile: use wa.me (opens WhatsApp app directly)\r\n                                whatsapp_url = `https://wa.me/${mobile}?text=${encodeURIComponent(msg)}`;\r\n                            } else {\r\n                                // Desktop: use api.whatsapp.com (opens WhatsApp Web)\r\n                                whatsapp_url = `https://api.whatsapp.com/send?phone=${mobile}&text=${encodeURIComponent(msg)}`;\r\n                            }\r\n                            \r\n                            window.open(whatsapp_url, \"_blank\");\r\n                            d.hide();\r\n                            \r\n                            frappe.show_alert({\r\n                                message: __(\"WhatsApp opened! Message is pre-filled.\"),\r\n                                indicator: \"green\"\r\n                            }, 5);\r\n                        },\r\n                        secondary_action_label: __('Copy Message'),\r\n                        secondary_action: function() {\r\n                            // Copy to clipboard\r\n                            navigator.clipboard.writeText(msg).then(function() {\r\n                                frappe.show_alert({\r\n                                    message: __(\"Message copied! Now open WhatsApp manually.\"),\r\n                                    indicator: \"blue\"\r\n                                }, 5);\r\n                            }).catch(function(err) {\r\n                                frappe.msgprint(__(\"Could not copy message. Please copy manually.\"));\r\n                            });\r\n                        }\r\n                    });\r\n                    \r\n                    d.show();\r\n\r\n                } catch (error) {\r\n                    console.error(\"WhatsApp Error:\", error);\r\n                    frappe.msgprint({\r\n                        title: __(\"Error\"),\r\n                        message: __(\"Error while preparing WhatsApp message. Please check console.\"),\r\n                        indicator: \"red\"\r\n                    });\r\n                }\r\n            }, __(\"Actions\"));\r\n        }\r\n    }\r\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-10-22 16:44:58.835016",
  "module": "Shree",
  "name": "Custom Sales Order",
  "script": "frappe.ui.form.on('Sales Order', {\r\n    delivery_date: function(frm) {\r\n        if(frm.doc.delivery_date) {\r\n            frm.doc.items.forEach(function(item) {\r\n                item.delivery_date = frm.doc.delivery_date;\r\n            });\r\n            frm.refresh_field('items');\r\n        }\r\n    }\r\n});\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Invoice PDF Upload",
  "enabled": 1,
  "modified": "2025-11-05 14:35:47.594217",
  "module": "Shree",
  "name": "Custom Invoice PDF Upload",
  "script": "// Client Script for Invoice PDF Upload DocType - Multipage Support\r\n\r\nfrappe.ui.form.on('Invoice PDF Upload', {\r\n    refresh: function(frm) {\r\n        // Show statistics for multipage invoices\r\n        if (frm.doc.page_count && frm.doc.page_count > 1) {\r\n            frm.dashboard.add_indicator(\r\n                __('Multipage Invoice: {0} pages', [frm.doc.page_count]), \r\n                'blue'\r\n            );\r\n        }\r\n        \r\n        // Preview button\r\n        if (frm.doc.pdf_file && !frm.doc.sales_invoice) {\r\n            frm.add_custom_button(__('Preview Extracted Data'), function() {\r\n                frappe.call({\r\n                    method: 'preview_extracted_data',\r\n                    doc: frm.doc,\r\n                    freeze: true,\r\n                    freeze_message: __('Processing multipage PDF...'),\r\n                    callback: function(r) {\r\n                        if (r.message) {\r\n                            show_extraction_preview(frm, r.message);\r\n                        }\r\n                    }\r\n                });\r\n            }).addClass('btn-primary');\r\n        }\r\n        \r\n        // View invoice button\r\n        if (frm.doc.sales_invoice) {\r\n            frm.add_custom_button(__('View Sales Invoice'), function() {\r\n                frappe.set_route('Form', 'Sales Invoice', frm.doc.sales_invoice);\r\n            });\r\n        }\r\n        \r\n        // Bulk upload button (only for System Manager)\r\n        if (frappe.user.has_role('System Manager')) {\r\n            frm.add_custom_button(__('Bulk Upload'), function() {\r\n                show_bulk_upload_dialog();\r\n            }, __('Actions'));\r\n        }\r\n        \r\n        // Status indicators\r\n        if (frm.doc.invoice_status === 'Processed') {\r\n            frm.dashboard.set_headline_alert(\r\n                __('Invoice created successfully with {0} items', \r\n                [frm.doc.extracted_data ? JSON.parse(frm.doc.extracted_data).items.length : 0]), \r\n                'green'\r\n            );\r\n        } else if (frm.doc.invoice_status === 'Failed') {\r\n            frm.dashboard.set_headline_alert(\r\n                __('Extraction failed. Check error log below.'), \r\n                'red'\r\n            );\r\n        }\r\n    },\r\n    \r\n    pdf_file: function(frm) {\r\n        if (frm.doc.pdf_file) {\r\n            frm.set_value('invoice_status', 'Pending');\r\n        }\r\n    },\r\n    \r\n    is_multipage: function(frm) {\r\n        // Show/hide multipage settings\r\n        frm.refresh_field('page_count');\r\n        frm.refresh_field('remove_subtotals');\r\n        frm.refresh_field('merge_split_items');\r\n    }\r\n});\r\n\r\n// Helper function to show extraction preview\r\nfunction show_extraction_preview(frm, data) {\r\n    let items_html = '';\r\n    \r\n    if (data.items && data.items.length > 0) {\r\n        items_html = '<table class=\"table table-bordered\" style=\"margin-top: 10px;\">';\r\n        items_html += '<thead><tr><th>Item Code</th><th>Item Name</th><th>Qty</th><th>Rate</th><th>Amount</th></tr></thead>';\r\n        items_html += '<tbody>';\r\n        \r\n        data.items.forEach(item => {\r\n            items_html += `<tr>\r\n                <td>${item.item_code || '-'}</td>\r\n                <td>${item.item_name || '-'}</td>\r\n                <td>${item.qty || 0}</td>\r\n                <td>‚Çπ${(item.rate || 0).toFixed(2)}</td>\r\n                <td>‚Çπ${(item.amount || 0).toFixed(2)}</td>\r\n            </tr>`;\r\n        });\r\n        \r\n        items_html += '</tbody></table>';\r\n    }\r\n    \r\n    let d = new frappe.ui.Dialog({\r\n        title: __('Extracted Data Preview'),\r\n        size: 'extra-large',\r\n        fields: [\r\n            {\r\n                fieldname: 'info',\r\n                fieldtype: 'HTML',\r\n                options: `\r\n                    <div class=\"row\">\r\n                        <div class=\"col-md-6\">\r\n                            <p><strong>Customer:</strong> ${data.customer_name || 'Not found'}</p>\r\n                            <p><strong>Date:</strong> ${data.invoice_date || 'Not found'}</p>\r\n                            ${data.page_count ? `<p><strong>Pages Processed:</strong> ${data.page_count}</p>` : ''}\r\n                        </div>\r\n                        <div class=\"col-md-6\">\r\n                            <p><strong>Items Count:</strong> ${data.items ? data.items.length : 0}</p>\r\n                            <p><strong>Total Amount:</strong> ‚Çπ${(data.total_amount || 0).toFixed(2)}</p>\r\n                            <p><strong>Tax Amount:</strong> ‚Çπ${(data.tax_amount || 0).toFixed(2)}</p>\r\n                        </div>\r\n                    </div>\r\n                    ${data.notes ? `<div class=\"alert alert-info\">${data.notes}</div>` : ''}\r\n                    <h5 style=\"margin-top: 15px;\">Items List</h5>\r\n                    ${items_html}\r\n                `\r\n            },\r\n            {\r\n                fieldname: 'raw_json',\r\n                fieldtype: 'Code',\r\n                options: 'JSON',\r\n                label: 'Raw JSON Data',\r\n                read_only: 1\r\n            }\r\n        ],\r\n        primary_action_label: __('Create Invoice'),\r\n        primary_action(values) {\r\n            frm.set_value('auto_create_invoice', 1);\r\n            frm.save().then(() => {\r\n                d.hide();\r\n                frappe.show_alert({\r\n                    message: __('Invoice creation started...'),\r\n                    indicator: 'blue'\r\n                });\r\n            });\r\n        }\r\n    });\r\n    \r\n    d.set_value('raw_json', JSON.stringify(data, null, 2));\r\n    d.show();\r\n}\r\n\r\n// Bulk upload dialog\r\nfunction show_bulk_upload_dialog() {\r\n    frappe.prompt([\r\n        {\r\n            fieldname: 'folder_path',\r\n            fieldtype: 'Data',\r\n            label: 'Server Folder Path',\r\n            reqd: 1,\r\n            description: 'Full path to folder containing PDF files on server'\r\n        },\r\n        {\r\n            fieldname: 'auto_create',\r\n            fieldtype: 'Check',\r\n            label: 'Auto Create Invoices',\r\n            default: 1\r\n        }\r\n    ], function(values) {\r\n        frappe.call({\r\n            method: 'invoice_extractor.invoice_extractor.doctype.invoice_pdf_upload.invoice_pdf_upload.process_multipage_pdf_folder',\r\n            args: values,\r\n            freeze: true,\r\n            freeze_message: __('Processing bulk upload...'),\r\n            callback: function(r) {\r\n                if (r.message) {\r\n                    show_bulk_results(r.message);\r\n                }\r\n            }\r\n        });\r\n    }, __('Bulk Upload PDFs'), __('Start Processing'));\r\n}\r\n\r\n// Show bulk processing results\r\nfunction show_bulk_results(results) {\r\n    let success = results.filter(r => r.status === 'Success').length;\r\n    let failed = results.filter(r => r.status === 'Failed').length;\r\n    \r\n    let html = `\r\n        <div class=\"alert alert-info\">\r\n            <strong>Processing Complete</strong><br>\r\n            Success: ${success} | Failed: ${failed}\r\n        </div>\r\n        <table class=\"table table-bordered\">\r\n            <thead>\r\n                <tr><th>File</th><th>Status</th><th>Invoice</th><th>Items</th></tr>\r\n            </thead>\r\n            <tbody>\r\n    `;\r\n    \r\n    results.forEach(r => {\r\n        html += `<tr>\r\n            <td>${r.file}</td>\r\n            <td><span class=\"indicator ${r.status === 'Success' ? 'green' : 'red'}\">${r.status}</span></td>\r\n            <td>${r.invoice || '-'}</td>\r\n            <td>${r.items_count || '-'}</td>\r\n        </tr>`;\r\n    });\r\n    \r\n    html += '</tbody></table>';\r\n    \r\n    frappe.msgprint({\r\n        title: __('Bulk Processing Results'),\r\n        message: html,\r\n        indicator: success > failed ? 'green' : 'orange',\r\n        wide: true\r\n    });\r\n}",
  "view": "Form"
 }
]